# DSvn - èåˆ SVN + Perforce + Git ä¼˜åŠ¿çš„é«˜æ€§èƒ½ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ

> **DSvn = SVN åè®® + P4 æ¶æ„ + Git å­˜å‚¨ + Rust å®ç°**

## âš¡ å¿«é€Ÿæ¦‚è§ˆ

DSvn æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œ**å®Œå…¨å…¼å®¹ SVN å®¢æˆ·ç«¯**ï¼Œä½†å†…éƒ¨é‡‡ç”¨å…¨æ–°çš„æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SVN å®¢æˆ·ç«¯                             â”‚
â”‚              (svn, TortoiseSVN, IDE plugins, etc.)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/WebDAV (å®Œå…¨å…¼å®¹)
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DSvn æœåŠ¡å™¨                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  åè®®å±‚: WebDAV/DeltaV (SVN å…¼å®¹)                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  åˆ†å¸ƒå¼å±‚: è¾¹ç¼˜ä»£ç† + é›†ç¾¤æ¨¡å¼ (å€Ÿé‰´ P4)              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  ç¼“å­˜å±‚: å¤šå±‚æ™ºèƒ½ç¼“å­˜ + é¢„æµ‹é¢„å– (å€Ÿé‰´ P4)            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  å­˜å‚¨å±‚: å†…å®¹å¯»å€ + åˆ†å±‚å­˜å‚¨ (å€Ÿé‰´ Git)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. åè®®å…¼å®¹ï¼ˆæ¥è‡ª SVNï¼‰
- âœ… å®Œå…¨å…¼å®¹ SVN WebDAV/DeltaV åè®®
- âœ… æ”¯æŒæ‰€æœ‰æ ‡å‡† SVN å®¢æˆ·ç«¯
- âœ… æ— éœ€æ”¹å˜ç”¨æˆ·ä¹ æƒ¯

### 2. åˆ†å¸ƒå¼æ¶æ„ï¼ˆæ¥è‡ª Perforceï¼‰
- âœ… è¾¹ç¼˜ä»£ç†ï¼šå…¨çƒä½å»¶è¿Ÿè®¿é—®
- âœ… æµå¼ä¼ è¾“ï¼šæ”¯æŒ TB çº§æ–‡ä»¶
- âœ… æ™ºèƒ½ç¼“å­˜ï¼šå¤šå±‚ + é¢„æµ‹é¢„å–
- âœ… å¹¶è¡Œäº‹åŠ¡ï¼šé«˜å¹¶å‘æäº¤

### 3. å†…å®¹å¯»å€ï¼ˆæ¥è‡ª Gitï¼‰
- âœ… è‡ªåŠ¨å»é‡
- âœ… O(1) å¯¹è±¡æŸ¥æ‰¾
- âœ… é«˜æ•ˆå‹ç¼©

### 4. ç°ä»£åŒ–å®ç°
- âœ… Rustï¼šå†…å­˜å®‰å…¨ + é«˜æ€§èƒ½
- âœ… å¼‚æ­¥ I/Oï¼šé«˜å¹¶å‘
- âœ… HTTP/2ï¼šå¤šè·¯å¤ç”¨

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | SVN (FSFS) | DSvn v2.0 | æå‡ |
|-----|-----------|----------|------|
| **æ£€å‡º 100 ä¸‡æ–‡ä»¶** | 30 åˆ†é’Ÿ | **30 ç§’** | 60x |
| **æ£€å‡º 10GB æ–‡ä»¶** | å†…å­˜æº¢å‡º | **2 åˆ†é’Ÿ** | âˆ |
| **100 å¹¶å‘æäº¤** | é”ç­‰å¾… | **æ— å½±å“** | âˆ |
| **å…¨çƒè®¿é—®å»¶è¿Ÿ** | > 500ms | **< 10ms** | 50x |
| **çƒ­æ–‡ä»¶è¯»å–** | ç£ç›˜ I/O | **å†…å­˜** | 1000x |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… Rust

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

### 2. æ„å»º DSvn

```bash
git clone https://github.com/yourusername/dsvn.git
cd dsvn
cargo build --release
```

### 3. åˆå§‹åŒ–ä»“åº“

```bash
./target/release/dsvn-admin init /data/repos/my-project
```

### 4. å¯åŠ¨æœåŠ¡å™¨

```bash
./target/release/dsvn start \
  --repo-root /data/repos/my-project \
  --hot-path /data/repos/my-project/hot \
  --warm-path /data/repos/my-project/warm \
  --addr 0.0.0.0:8080
```

### 5. ä½¿ç”¨ SVN å®¢æˆ·ç«¯

```bash
# æ£€å‡º
svn checkout http://localhost:8080/svn my-working-copy

# æäº¤
cd my-working-copy
echo "Hello DSvn" > README.md
svn add README.md
svn commit -m "Initial commit"

# æ›´æ–°
svn update

# æ—¥å¿—
svn log
```

## ğŸŒ åˆ†å¸ƒå¼éƒ¨ç½²ï¼ˆè¾¹ç¼˜ä»£ç†ï¼‰

### ä¸»æœåŠ¡å™¨ï¼ˆç¾å›½ï¼‰

```bash
dsvn-server \
  --repo-root /data/repos \
  --addr 0.0.0.0:8080
```

### è¾¹ç¼˜ä»£ç†ï¼ˆåŒ—äº¬ï¼‰

```bash
dsvn-proxy \
  --upstream https://us-server.example.com \
  --cache-dir /var/cache/dsvn \
  --cache-size 100GB \
  --addr 0.0.0.0:8080
```

### è¾¹ç¼˜ä»£ç†ï¼ˆä¼¦æ•¦ï¼‰

```bash
dsvn-proxy \
  --upstream https://us-server.example.com \
  --cache-dir /var/cache/dsvn \
  --cache-size 100GB \
  --addr 0.0.0.0:8080
```

**æ•ˆæœ**ï¼š
- åŒ—äº¬å›¢é˜Ÿè®¿é—®å»¶è¿Ÿï¼š< 10ms
- ä¼¦æ•¦å›¢é˜Ÿè®¿é—®å»¶è¿Ÿï¼š< 10ms
- è‡ªåŠ¨ç¼“å­˜çƒ­æ•°æ®
- æ•…éšœè‡ªåŠ¨åˆ‡æ¢

## ğŸ“š æ–‡æ¡£

- **[OVERVIEW.md](OVERVIEW.md)** - é¡¹ç›®æ¦‚è¿°
- **[ARCHITECTURE_V2.md](ARCHITECTURE_V2.md)** - v2.0 æ¶æ„è®¾è®¡
- **[PERFORCE_ANALYSIS.md](PERFORCE_ANALYSIS.md)** - Perforce ä¼˜åŠ¿åˆ†æ
- **[ROADMAP.md](ROADMAP.md)** - å®æ–½è·¯çº¿å›¾
- **[COMPARISON.md](COMPARISON.md)** - vs SVN å¯¹æ¯”
- **[DEVELOPMENT.md](DEVELOPMENT.md)** - å¼€å‘æŒ‡å—

## ğŸ—ºï¸ å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€ MVP (å½“å‰)
- [x] é¡¹ç›®ç»“æ„
- [x] å¯¹è±¡æ¨¡å‹
- [x] å­˜å‚¨æ¡†æ¶
- [ ] WebDAV åè®® â† å½“å‰
- [ ] åŸºç¡€æµ‹è¯•

### Phase 2: P4 ç‰¹æ€§ï¼ˆä¸‹ä¸€æ­¥ï¼‰
- [ ] æµå¼ä¼ è¾“
- [ ] æ™ºèƒ½ç¼“å­˜
- [ ] å¹¶è¡Œäº‹åŠ¡

### Phase 3: åˆ†å¸ƒå¼
- [ ] è¾¹ç¼˜ä»£ç†
- [ ] é›†ç¾¤æ¨¡å¼

### Phase 4: ä¼˜åŒ–
- [ ] æ€§èƒ½è°ƒä¼˜
- [ ] ç›‘æ§è¿ç»´
- [ ] å®‰å…¨åŠ å›º

## âš ï¸ é‡è¦æç¤º

### å­˜å‚¨ä¸å…¼å®¹

DSvn **ä¸å…¼å®¹** Subversion çš„ FSFS å­˜å‚¨æ ¼å¼ï¼š

- âŒ æ— æ³•ç›´æ¥è¯»å– SVN ä»“åº“
- âœ… éœ€è¦é€šè¿‡ `svnadmin dump/load` è¿ç§»
- âœ… è¿™æ˜¯æ€§èƒ½æå‡çš„å¿…è¦ä»£ä»·

### æ•°æ®è¿ç§»

```bash
# ä» SVN è¿ç§»åˆ° DSvn
svnadmin dump /path/to/svn/repo > repo.dump
dsvn-admin load /path/to/dsvn/repo < repo.dump
```

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… å¼ºçƒˆæ¨è DSvn

- **è¶…å¤§å‹ä»“åº“**ï¼š> 100 ä¸‡æ–‡ä»¶
- **é«˜å¹¶å‘åœºæ™¯**ï¼š> 100 å¹¶å‘ç”¨æˆ·
- **å…¨çƒå›¢é˜Ÿ**ï¼šéœ€è¦ä½å»¶è¿Ÿè®¿é—®
- **å¤§æ–‡ä»¶**ï¼šé¢‘ç¹å¤„ç† > 1GB æ–‡ä»¶
- **äº‘åŸç”Ÿ**ï¼šå®¹å™¨åŒ–ã€Kubernetes ç¯å¢ƒ

### â³ ç»§ç»­ä½¿ç”¨ SVN

- **å°å‹ä»“åº“**ï¼š< 1 ä¸‡æ–‡ä»¶
- **å•ä¸€åœ°ç‚¹**ï¼šæ— åˆ†å¸ƒå¼éœ€æ±‚
- **ä¾èµ–å·¥å…·**ï¼šä¾èµ–ç‰¹å®š SVN é›†æˆ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·å‚é˜… [DEVELOPMENT.md](DEVELOPMENT.md)

## ğŸ“„ è®¸å¯è¯

MIT OR Apache-2.0

## ğŸ™ è‡´è°¢

- **Apache Subversion** - åè®®è§„èŒƒ
- **Perforce** - æ¶æ„çµæ„Ÿ
- **Git** - å­˜å‚¨æ¨¡å‹
- **Rust ç¤¾åŒº** - ä¼˜ç§€å·¥å…·é“¾

---

**æ³¨æ„**: DSvn æ˜¯ä¸€ä¸ªç‹¬ç«‹é¡¹ç›®ï¼Œä¸ Apache Subversion å’Œ Perforce æ— å…³ã€‚æˆ‘ä»¬å€Ÿé‰´äº†å®ƒä»¬çš„ä¼˜åŠ¿ï¼Œä½†å®ç°å®Œå…¨ç‹¬ç«‹ã€‚
